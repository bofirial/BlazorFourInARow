@using BlazorFourInARow.BusinessLogic

@inherits Microsoft.AspNetCore.Blazor.Layouts.BlazorLayoutComponent

@inject IUserConnectionInfoStore UserConnectionInfoStore

@inject ApplicationReseter ApplicationReseter

<HeaderNavigation CurrentUser="@UserConnectionInfo?.User" />

<div class="main container px-4 pt-1">
    @if (null != UserConnectionInfo)
    {
        @Body
    }
    else
    {
        <UserRegistration />
    }
</div>

@functions {
public UserConnectionInfo UserConnectionInfo = null;

protected void SetUserConnectionInfo(UserConnectionInfo userConnectionInfo)
{
    UserConnectionInfo = userConnectionInfo;
    StateHasChanged();
}

protected override async Task OnInitAsync()
{
    SetUserConnectionInfo(await UserConnectionInfoStore.GetUserConnectionInfoAsync());

    UserConnectionInfoStore.UserConnectionInfoChanged += SetUserConnectionInfo;
}
}